@startuml LoggaF√•ngstFull
title Logga en f√•ngst

!define RECTANGLE class
skinparam backgroundColor #F8FAFC
skinparam activity {
  BackgroundColor<<Client>> #E3F2FD
  BackgroundColor<<Server>> #E8F5E9
  BackgroundColor<<Error>> #FFEBEE
  BorderColor #333
}

start

partition "üì± Klient (App)" <<Client>> {
  :Anv√§ndaren √∂ppnar appen;
  :V√§ljer "Ny f√•ngst";

  :Ta foto p√• f√•ngsten;
  note right:
  if (Foto lyckades?) then (Nej)
    :Visa alert "Kunde inte ta foto"; <<Error>>
    stop
  endif

  :Ange vikt, l√§ngd och antal;

  :Ange metod och drag;

  :Beg√§r GPS-position;
  note right: (US4)
  if (GPS till√•ten?) then (Nej)
    :Visa alert "√Ötkomst till plats nekad"; <<Error>>
    stop
  else (Ja)
    :Plats h√§mtas automatiskt;
  endif

  :Markera f√•ngst som Catch & Release (C/R);

  :Granska uppgifter och tryck "Spara f√•ngst";
  :Skicka data och foto till server;
}

partition "üñ•Ô∏è Server (Backend / Supabase)" <<Server>> {
  :Ta emot f√•ngstdata och foto;
  :Validera f√§lt (vikt, l√§ngd, metod, GPS, C/R);
  if (Validering godk√§nd?) then (Nej)
    :Returnera felmeddelande "Ogiltiga v√§rden"; <<Error>>
  else (Ja)
    :Spara data i databasen;
    :Ladda upp foto till lagring (Storage);
    if (Uppladdning lyckades?) then (Nej)
      :Returnera felmeddelande "Uppladdning misslyckades"; <<Error>>
    else (Ja)
      :Returnera svar {status: OK};
    endif
  endif
}

partition "üì± Klient (App)" <<Client>> {
  if (Svar = OK?) then (Ja)
    :Visa bekr√§ftelse "F√•ngst sparad!";
    :Navigera till f√•ngstlista / startsida;
  else (Nej)
    :Visa alert; <<Error>>
  endif
}

stop

@enduml
